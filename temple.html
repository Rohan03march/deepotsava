<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>ISKCON Bangalore</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

    <!-- Favicon -->
    <link href="./assets/img/iskcon-fevicon.png" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jost:wght@500;600;700&family=Open+Sans:wght@400;500&display=swap" rel="stylesheet">  

    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    
    <!-- Libraries Stylesheet -->
    <link href="lib/animate/animate.min.css" rel="stylesheet">
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="lib/lightbox/css/lightbox.min.css" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="assets/css/style.css" rel="stylesheet">
</head>

<body>
    <!-- Spinner Start -->
    <div id="spinner" class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;"></div>
    </div>
    <!-- Spinner End -->

    <!-- Navbar Start -->
    <nav class="navbar navbar-expand-lg bg-white navbar-light sticky-top p-0">
        <a href="index.html" class="navbar-brand d-flex align-items-center px-4 px-lg-5">
            <img src="assets/img/iskcon-bangalore-logo-black.png" alt="">
        </a>
        <button type="button" class="navbar-toggler me-4" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
            <div class="navbar-nav ms-auto p-4 p-lg-0">
                <a href="indexs.html" class="nav-item nav-link">Back</a>
                <a href="index.html" class="nav-item nav-link">Logout</a>
            </div>
        </div>
    </nav>
    <!-- Navbar End -->

    <body>
        <h1>Visit a Temple</h1>
       
        <div class="container">
            <div class="text">
                <p style="color:black;font-size:24px">
                    Visiting a temple and having darshan of the Lord is an essential part of devotional life. The spiritual atmosphere of the temple calms the mind, dispels negativity, and blesses us with the protection and grace of the Lord.
                </p>
                <p style="color:black;font-size:24px">
                    Today, visit a temple dedicated to Lord Krishna, Vishnu, or any of His incarnations, such as Lord Rama or Narasimha.
                </p>
            </div>
            <div class="UploadImage">
                <h2 style="color: black; text-align:center">Upload a photo of your visit.</h1>
                <div id="dropZone">
                    <img src="assets/images/image.png" alt="Upload Icon" />
                    <p style="color:black;font-size:20px">Drag and Drop to Upload Image <br/> OR  <br/><span class="clickToUpload">Click to upload</span> </p>
                </div>
                <input type="file" id="fileInput" accept="image/*" style="display: none;" multiple />
                <p id="status" style="color:rgb(0, 0, 0);"></p>
                <div id="progressContainer" style="display: none;">
                    <div id="progressBar" style="width: 0%; height: 20px; background-color: blue; transition: width 0.5s;"></div>
                    <div id="progressText" style="text-align: center; margin-top: 5px; font-weight: bold; color:black">0%</div>
                </div>
            </div>
        </div>
        
        <style>
        .container {
            display: flex;
            justify-content: space-between;
        }
        
        .text, .UploadImage {
            flex: 1;
            padding: 20px;
        }
        
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            .text {
                order: 1;
                text-align: center;
            }
            .UploadImage {
                order: 2;
            }
        }
        </style>
         

    <div id="imageGrids"></div>
    
    
    <!--style for upload image-->
    <style>
        .UploadImage {
            font-family: 'Roboto', sans-serif; /* Use Roboto font */
            background-color: transparent;
            padding: 20px;
        }
        h1 {
            text-align: center;
            margin-bottom: 20px;
        }
    
        .clickToUpload {
            color:black;
        }
        .clickToUpload:hover {
            color: blue;
            text-decoration: underline;
        }
        #dropZone {
            border: 2px dashed black;
            border-radius: 10px;
            padding:100px;
            text-align: center;
            transition: background-color 0.3s;
            margin: 0 auto;
            width: 80%;
            cursor: pointer;
            position: relative;
        }
          
        @media (max-width: 768px) {
           #dropZone {
            padding: 30px;
           }
        }

        #dropZone:hover {
            background-color: transparent;
        }
        #dropZone img {
            width: 50px; /* Icon size */
            height: auto;
            margin-bottom: 10px;
        }
        #status {
            text-align: center;
            margin-top: 10px;
            color: #555;
        }
        #imageGrids {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        .imageContainer {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
        }
        .imageContainer img {
            width: 100%;
            height: auto;
            border-radius: 5px;
        }
        .deleteButton {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: red;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            padding: 5px 10px;
        }
        #progressContainer {
            width: 100%;
            max-width: 400px; /* Limit the width of the progress bar */
            margin: 20px auto; /* Center the container */
            text-align: center; /* Center text within the container */
            border-radius: 20px;
        }
        
        #progressBar {
            background-color: blue; /* Initial color */
            transition: width 0.5s ease; /* Smooth transition for the width */
            border-radius: 20px;
        }
        
        @media (max-width: 900px) {
            #imageGrids {
                grid-template-columns: repeat(3, 1fr); /* 3 columns for tablets */
            }
        }
        
        @media (max-width: 600px) {
            #imageGrids {
                grid-template-columns: repeat(2, 1fr); /* 2 columns for phones */
            }
        }
        
        @media (max-width: 400px) {
            #imageGrids {
                grid-template-columns: 1fr; /* 1 column for small phones */
            }
        }
    </style>
    <!--style for upload image-->
    
    </div>
    <!--/Upload Image section -->
    
    
    
    
      <!--imports-->
      <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc, arrayUnion, arrayRemove, increment } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytesResumable, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBypZ0BZnoY-UVzb_3Hs0116vwu6OWmrCc",
            authDomain: "iskcon-contest-3bf89.firebaseapp.com",
            projectId: "iskcon-contest-3bf89",
            storageBucket: "iskcon-contest-3bf89.appspot.com",
            messagingSenderId: "216348940232",
            appId: "1:216348940232:web:1c8de66866f589ce1f92fd",
            measurementId: "G-CJJLTTHHFJ"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        let userId;

        document.addEventListener("DOMContentLoaded", () => {
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    userId = user.uid;
                    await loadImages("temple");
                } else {
                    window.location.href = "login.html"; // Redirect if not logged in
                }
            });

            document.getElementById("dropZone").addEventListener("click", () => {
                document.getElementById("fileInput").click();
            });

            document.getElementById("fileInput").addEventListener("change", (e) => {
                handleFiles(e.target.files);
            });

            async function handleFiles(files) {
                for (let file of files) {
                    if (!file.type.startsWith("image/")) {
                        continue;
                    }

                    const originalName = file.name.split(".")[0];
                    const extension = file.name.split(".").pop();
                    const newFileName = `${originalName}_${Date.now()}.${extension}`;

                    const storageRef = ref(storage, `${userId}/${newFileName}`);
                    const uploadTask = uploadBytesResumable(storageRef, file);

                    const progressContainer = document.getElementById("progressContainer");
                    const progressBar = document.getElementById("progressBar");
                    const progressText = document.getElementById("progressText");
                    progressContainer.style.display = "block";

                    uploadTask.on(
                        "state_changed",
                        (snapshot) => {
                            const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                            progressBar.style.width = `${progress}%`;
                            progressText.innerText = `${Math.floor(progress)}%`;
                        },
                        (error) => {
                            document.getElementById("status").innerText = "Upload failed: " + error.message;
                            progressContainer.style.display = "none";
                        },
                        async () => {
                            const downloadURL = await getDownloadURL(uploadTask.snapshot.ref);
                            const imageObject = { 
                                url: downloadURL, 
                                name: newFileName, 
                                timestamp: new Date().toLocaleString(),
                                source: "temple"
                            };

                            const userDocRef = doc(db, "users", userId);
                            await updateDoc(userDocRef, {
                                images: arrayUnion(imageObject),
                                imagePoints: increment(10),
                            });

                            displayImage(imageObject);
                            progressContainer.style.display = "none";
                        }
                    );
                }
            }

            async function loadImages(source) {
                const userDocRef = doc(db, "users", userId);
                const userDoc = await getDoc(userDocRef);

                if (userDoc.exists()) {
                    const images = userDoc.data().images || [];
                    const filteredImages = images.filter(image => image.source === source);
                    filteredImages.forEach((image) => {
                        displayImage(image);
                    });
                }
            }
            function displayImage(image) {
                const imageGrids = document.getElementById("imageGrids");
            
                const imageContainer = document.createElement("div");
                imageContainer.classList.add("imageContainer");
            
                const img = document.createElement("img");
                img.src = image.url;
                img.alt = image.name;
            
                // Format the date and time
                const formattedDate = formatDate(new Date(image.timestamp));
            
                const timestamp = document.createElement("p");
                timestamp.innerText = `Uploaded on: ${formattedDate}`;
                timestamp.style.fontSize = "15px";
                timestamp.style.textAlign = "center";
                timestamp.style.color = "black"; // Set color to black
                timestamp.style.fontWeight = "bold"; // Make the text bold
            
                const deleteButton = document.createElement("button");
                deleteButton.innerText = "Delete";
                deleteButton.classList.add("deleteButton");
            
                deleteButton.addEventListener("click", async () => {
                    const storageRef = ref(storage, `${userId}/${image.name}`);
                    try {
                        await deleteObject(storageRef);
                        const userDocRef = doc(db, "users", userId);
                        await updateDoc(userDocRef, {
                            images: arrayRemove(image),
                            imagePoints: increment(-10),
                        });
                        imageGrids.removeChild(imageContainer);
                    } catch (error) {
                        alert("Error deleting image: " + error.message);
                    }
                });
            
                imageContainer.appendChild(img);
                imageContainer.appendChild(timestamp);
                imageContainer.appendChild(deleteButton);
                imageGrids.appendChild(imageContainer);
            }
            
            
            function formatDate(date) {
                const options = { 
                    day: '2-digit', 
                    month: '2-digit', 
                    year: 'numeric', 
                    hour: '2-digit', 
                    minute: '2-digit', 
                    hour12: true 
                };
                return new Intl.DateTimeFormat('en-IN', options).format(date);
            }
            
            
        });
    </script>
    
      <!--disable this page 
    <script>
      document.addEventListener('contextmenu', (event) => {
          event.preventDefault();
      });
    </script> -->
    </body>
   
</div> 

<!-- Features End -->
<br/>

    <!-- Back to Top -->
    <a href="#" class="btn btn-primary btn-lg-square rounded-circle back-to-top"><i class="bi bi-arrow-up"></i></a>
<style>
    .back-to-top {
        background-color: #3F1906;
    }
.back-to-top:hover {
    background-color: #CEBDB6;
}    
</style>


    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="lib/wow/wow.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="lib/counterup/counterup.min.js"></script>
    <script src="lib/parallax/parallax.min.js"></script>
    <script src="lib/isotope/isotope.pkgd.min.js"></script>
    <script src="lib/lightbox/js/lightbox.min.js"></script>
  

    <!-- Template Javascript -->
    <script src="assets/js/main.js"></script>
</body>

</html>